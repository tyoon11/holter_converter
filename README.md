ë¬¼ë¡ ì´ì£ , íƒœìœ¤ë‹˜!
ì§€ê¸ˆê¹Œì§€ì˜ ì„¤ëª…ì„ ëª¨ë‘ ë°˜ì˜í•œ **ìµœì¢… `README.md` í†µí•©ë³¸**ì„ ì•„ë˜ì— ì œê³µí•´ë“œë¦´ê²Œìš”. ê·¸ëŒ€ë¡œ ë³µì‚¬í•´ì„œ ë¶™ì—¬ ë„£ìœ¼ë©´ ë°”ë¡œ ì‚¬ìš© ê°€ëŠ¥í•©ë‹ˆë‹¤.

---

````markdown
# Holter ECG Raw to HDF5 ë³€í™˜ íŒŒì´í”„ë¼ì¸

ì´ í”„ë¡œì íŠ¸ëŠ” Holter ECG raw ë°ì´í„°ë¥¼ ë¶„ì„ ê°€ëŠ¥í•œ êµ¬ì¡°ë¡œ ë³€í™˜í•˜ì—¬ `.h5` í˜•ì‹ìœ¼ë¡œ ì €ì¥í•˜ëŠ” íŒŒì´í”„ë¼ì¸ì„ ì œê³µí•©ë‹ˆë‹¤.

---

## ğŸ“¦ ì˜ì¡´ì„± ì„¤ì¹˜

ë‹¤ìŒ Python íŒ¨í‚¤ì§€ë¥¼ ì„¤ì¹˜í•´ì•¼ í•©ë‹ˆë‹¤:

```
pip install pandas numpy h5py matplotlib neurokit2 dtw wfdb ray
````

---

## ğŸ“ íŒŒì¼ êµ¬ì„±

| íŒŒì¼ëª…                      | ì„¤ëª…                                                                                    |
| ------------------------ | ------------------------------------------------------------------------------------- |
| `fix_pid.py`             | `.hea`, `.json` íŒŒì¼ ë‚´ì˜ PID ë° ë ˆì½”ë“œëª…ì„ íŒŒì¼ëª… ê¸°ì¤€ìœ¼ë¡œ ì •ì •í•©ë‹ˆë‹¤. **ë³€í™˜ ì „ í•„ìˆ˜ ì‚¬ì „ ì‘ì—…ì…ë‹ˆë‹¤.**               |
| `utils.py`               | HDF5 ë³€í™˜ì— í•„ìš”í•œ ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜ë“¤ì„ ì •ì˜í•œ ëª¨ë“ˆì…ë‹ˆë‹¤. (ì‹ í˜¸ í’ˆì§ˆ, fiducial í¬ì¸íŠ¸ ì¶”ì¶œ, ìœ íš¨ ë ˆì½”ë“œ ìë™ ìƒì„± ë“± í¬í•¨)         |
| `create_h5_structure.py` | ECG ì„¸ê·¸ë¨¼íŠ¸ ê¸°ë°˜ì˜ HDF5 ì €ì¥ êµ¬ì¡°ë¥¼ ì •ì˜í•˜ê³ , ë°ì´í„°ë¥¼ ì €ì¥í•˜ëŠ” í•¨ìˆ˜ë“¤ì„ í¬í•¨í•©ë‹ˆë‹¤.                                  |
| `convert_to_h5.py`       | raw ë°ì´í„°ë¥¼ `.h5` í˜•ì‹ìœ¼ë¡œ ë³€í™˜í•©ë‹ˆë‹¤. `valid_records.csv`ê°€ ì—†ì„ ê²½ìš° ìë™ìœ¼ë¡œ ìƒì„±ë˜ë©°, `ray`ë¥¼ ì‚¬ìš©í•´ ë³‘ë ¬ ì²˜ë¦¬ë©ë‹ˆë‹¤. |
| `h5_test.ipynb`          | ìƒì„±ëœ `.h5` íŒŒì¼ì˜ êµ¬ì¡°ë¥¼ íƒìƒ‰í•˜ê³  ë‚´ìš©ì„ ì‹œê°í™”í•˜ëŠ” Jupyter Notebookì…ë‹ˆë‹¤.                                 |

---

## ğŸ“Œ ì‚¬ì „ ì •ë¦¬: PID ë° ë ˆì½”ë“œëª… ì •ì •

Holter ì›ë³¸ ë°ì´í„°ëŠ” `.hea`, `.json` ë‚´ë¶€ì— ê¸°ë¡ëœ `record_name` ë° `PID`ê°€ íŒŒì¼ëª…ê³¼ ì¼ì¹˜í•˜ì§€ ì•ŠëŠ” ê²½ìš°ê°€ ìˆìŠµë‹ˆë‹¤.
ì´ë¡œ ì¸í•´ ì´í›„ íŒŒì´í”„ë¼ì¸ì—ì„œ ë ˆì½”ë“œ ê°„ ì¼ê´€ì„±ì´ ê¹¨ì§ˆ ìˆ˜ ìˆìœ¼ë¯€ë¡œ, **íŒŒì¼ëª…ì„ ê¸°ì¤€ìœ¼ë¡œ ë‚´ë¶€ ì •ë³´ë¥¼ ì •ì •í•˜ëŠ” ì‚¬ì „ ì‘ì—…ì´ í•„ìš”í•©ë‹ˆë‹¤.**

### âœ… fix\_pid.py ì‚¬ìš© ë°©ë²•

1. raw íŒŒì¼ ì „ì²´ë¥¼ **read/write ê¶Œí•œì´ ìˆëŠ” ë³„ë„ í´ë”**ë¡œ ë³µì‚¬í•©ë‹ˆë‹¤.
2. ì•„ë˜ ëª…ë ¹ì–´ë¥¼ ì‹¤í–‰í•˜ì—¬ `.hea`, `.json` íŒŒì¼ì˜ ë‚´ë¶€ ê°’ì„ ì •ì •í•©ë‹ˆë‹¤:

```bash
python fix_pid.py
```

> `.hea` íŒŒì¼: ëª¨ë“  ì¤„ì˜ `record_name`ì„ íŒŒì¼ëª…ìœ¼ë¡œ ë®ì–´ì”€
> `.json` íŒŒì¼: `"PatientInfo"`ì˜ `"PID"`ë¥¼ íŒŒì¼ëª…ì˜ PIDë¡œ ê°±ì‹ 

---

## ğŸš€ ì‹¤í–‰ íë¦„

1. `fix_pid.py` ì‹¤í–‰
   â†’ `.hea`, `.json` ë‚´ë¶€ì˜ ë ˆì½”ë“œëª…ì„ íŒŒì¼ëª… ê¸°ì¤€ìœ¼ë¡œ ì •ì •

   ```bash
   python fix_pid.py
   ```

2. `convert_to_h5.py` ì‹¤í–‰
   â†’ `.h5` íŒŒì¼ë¡œ ë³€í™˜ (ë‚´ë¶€ì ìœ¼ë¡œ `valid_records.csv`ê°€ ì—†ìœ¼ë©´ ìë™ ìƒì„±)

   ```bash
   python convert_to_h5.py
   ```

   âš ï¸ ë³‘ë ¬ ì²˜ë¦¬ì— ì‚¬ìš©í•  CPU ê°œìˆ˜ëŠ” `ray.init(num_cpus=...)`ì—ì„œ ì¡°ì ˆí•˜ì„¸ìš”.

---

## âš™ï¸ ì£¼ìš” ì„¤ì • ì˜µì…˜

`convert_to_h5.py` ì‹¤í–‰ ì‹œ ë‹¤ìŒê³¼ ê°™ì€ ì˜µì…˜ì„ í†µí•´ ì²˜ë¦¬ ì†ë„ì™€ ê¸°ëŠ¥ì„ ìœ ì—°í•˜ê²Œ ì¡°ì ˆí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:

| ì˜µì…˜ ì´ë¦„                  | ì„¤ëª…                                                                                                         |
| ---------------------- | ---------------------------------------------------------------------------------------------------------- |
| `use_dummy_fiducial`   | `True`ë¡œ ì„¤ì • ì‹œ, **fiducial point ë° ECG feature ì¶”ì¶œì„ ìƒëµ**í•˜ê³  `NaN` ë° ë¹ˆ ë¦¬ìŠ¤íŠ¸ë¡œ ì±„ì›ë‹ˆë‹¤. íŒŒì´í”„ë¼ì¸ì˜ ì‹¤í–‰ ì†ë„ë¥¼ ë†’ì´ê³ ì í•  ë•Œ ìœ ìš©í•©ë‹ˆë‹¤. |
| `use_dummy_similarity` | `True`ë¡œ ì„¤ì • ì‹œ, **beat ê°„ ìœ ì‚¬ë„(correlation, DTW distance) ê³„ì‚°ì„ ìƒëµ**í•©ë‹ˆë‹¤. ìœ ì‚¬í•˜ê²Œ `NaN`ìœ¼ë¡œ ëŒ€ì²´ë©ë‹ˆë‹¤.                     |

> ì˜ˆì‹œ:
>
> ```python
> convert_folder_to_h5_ray(
>     input_dir="...",
>     output_dir="...",
>     use_dummy_fiducial=True,
>     use_dummy_similarity=True
> )
> ```

---

## â›”ï¸ ì´ë¯¸ ë³€í™˜ëœ íŒŒì¼ ê±´ë„ˆë›°ê¸°

`convert_to_h5.py` ì‹¤í–‰ ì‹œ, **output ë””ë ‰í† ë¦¬ì— ë™ì¼í•œ ì´ë¦„ì˜ `.h5` íŒŒì¼ì´ ì´ë¯¸ ì¡´ì¬í•˜ë©´ í•´ë‹¹ ë ˆì½”ë“œëŠ” ìë™ìœ¼ë¡œ ê±´ë„ˆëœë‹ˆë‹¤.**
ì´ëŠ” ë¶ˆí•„ìš”í•œ ì¤‘ë³µ ê³„ì‚°ì„ ë°©ì§€í•˜ë©°, ì¤‘ë‹¨ í›„ ì¬ì‹œì‘ ì‹œ íš¨ìœ¨ì ìœ¼ë¡œ ì´ì–´ì„œ ì²˜ë¦¬í•  ìˆ˜ ìˆë„ë¡ ì„¤ê³„ë˜ì—ˆìŠµë‹ˆë‹¤.

---

## ğŸ”„ ì˜ˆì‹œ ì‹¤í–‰ ìŠ¤í¬ë¦½íŠ¸

```python
convert_folder_to_h5_ray(
    input_dir="/your/raw/data",
    output_dir="/your/output/h5",
    csv_path="output_h5_list.csv",
    sampling_rate=125,
    segment_sec=10,
    log_path="conversion_log.txt",
    valid_list_path="valid_records.csv",
    use_dummy_fiducial=True,
    use_dummy_similarity=True
)
```

---

## ğŸ§ª HDF5 êµ¬ì¡° í™•ì¸

`h5_test.ipynb`ë¥¼ í†µí•´ ìƒì„±ëœ `.h5` íŒŒì¼ì˜ êµ¬ì¡°ì™€ ë°ì´í„°ë¥¼ íƒìƒ‰í•˜ê³  ì‹œê°í™”í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.


---

